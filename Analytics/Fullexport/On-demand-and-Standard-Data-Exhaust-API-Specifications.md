
## Introduction:

* This wiki give the details about On demand data exhaust API submit, get job and list jobs API spec and standard exhaust API.


* Client should be able to request the report for particular batch or course by submitting the API.




## On-demand API details

###  Submit API
 POST:  **/dataset/v1/request/submit** 

 **Request Parameters** 


* request headers


    * X-Channel-ID - channel id / org id for request


    * X-Authenticated-Userid - requested user id



    

 **Request:** 
```json
{
  "id": "ekstep.analytics.job.request.submit",
  "ver": "1.0",
  "ts": "2016-12-07T12:40:40+05:30",
  "params": {
    "msgid": "4f04da60-1e24-4d31-aa7b-1daf91c46341" // unique request message id, UUID
  },
  "request": {
    "tag": String, // Unique identifier to identify request submitted.Ex: BatchId
    "encryptionKey": String, // Encryption Key
    "requestedBy": String, // requester id for submitted request
    "dataset" :String, // either assessment-report or course-report 
    "datasetConfig" {
      // config map
    }
  }
}
```
 **Response** :
```json
{
    "id": "ekstep.analytics.job.request.submit",
    "ver": "1.0",
    "ts": "2016-12-07T12:43:23.890+00:00",
    "params": {
        "msgid": "4f04da60-1e24-4d31-aa7b-1daf91c46341",
        "status": "successful"
    },
    "responseCode": "OK",
    "result": JobStatusResponse
}
```
 **JobStatusResponse** :
```
JobStatusResponse = {
    "requestId": String, // Request Id generated by Data out API
    "tag": String, // Unique identifier to identify request submitted
    "dataset": String, // either assessment-report or course-report
    "requestedBy": String, // requester id for submitted request
    "requestedChannel": String, // channel id/org id of request
    "status": String // SUBMITTED, SUCCESS OR FAILED if the request is made already
    "lastUpdated": DateTime, // Date Time in epoch format
    "datasetConfig": {}, // data passed in the API
    "downloadUrls": [], // list of pre-signed URL of report files
    "expiresAt": DateTime, // Expiry time of signed download URLs
    "jobStats": { // Job specific stats
        "dtJobSubmitted": DateTime, // DateTime when the job is submitted
        "dtJobCompleted": DateTime, // DateTime when the job is complete
        "executionTime": Int // Total time taken for processing excluding latency
    },
    attempts: Int // No. of times processed this request.
}
```
Sample Request :Sample Request


```json
{
  "id": "ekstep.analytics.job.request.submit",
  "ver": "1.0",
  "ts": "2016-12-07T12:40:40+05:30",
  "params": {
    "msgid": "4f04da60-1e24-4d31-aa7b-1daf91c46341"
  },
  "request": {
      "tag": "do_11299034610144870411_0131092891882700800",
      "requestedBy": "95e4942d-cbe8-477d-aebd-ad8e6de4bfc8",
      "dataset": "userinfo-exhaust",
      "encryptionKey": "xxx-yyy",
      "datasetConfig": {
          "batchId": "0131092891882700800"
      }
    }
}
```

### Get API

* Get the details for a particular request-id



 **URL - GET : dataset/v1/request/read/{tag}?requestId={request-id}** tag:  unique identifier for the requests submitted. For ex: courseId or batchId. **request-id : Unique Id in the submit request Response** 

 **Request Parameters** 


* request headers


    * X-Channel-ID - channel id / org id for request


    * X-Authenticated-Userid - requested user id



    

Response:


```json
{
    "id": "ekstep.analytics.job.request.info",
    "ver": "1.0",
    "ts": "2016-12-07T12:43:23.890+00:00",
    "params": {
        "resmsgid": "4f04da60-1e24-4d31-aa7b-1daf91c46341",
        "status": "successful"
    },
    "responseCode": "OK",
    "result": JobStatusResponse
}
```
Sample Response:

/dataset/v1/request/read/do_11299034610144870411_0131092891882700800?requestId=AF7B9BE5D0D075EA0DB8C6D12E192D5F
```
{
    "id": "ekstep.analytics.job.request.info",
    "ver": "1.0",
    "ts": "2016-12-07T12:43:23.890+00:00",
    "params": {
        "resmsgid": "4f04da60-1e24-4d31-aa7b-1daf91c46341",
        "status": "successful"
    },
    "responseCode": "OK",
    "result": {
        "attempts": 0,
        "lastUpdated": 1600845394119,
        "tag": "do_11299034610144870411_0131092891882700800:ORG_001",
        "expiresAt": 1598632215685,
        "datasetConfig": {
            "batchId": "0131092891882700800"
        },
        "downloadUrls": [
          "https://dev.blob.core.windows.net/reports/6a54bfa283de43a89086e69e2efdc9eb6750493d/reports-019243943994839.csv?sv=2017-04-17&se=2071-04-26T08%3A30%3A30Z&sr=b&sp=r&sig=61LYReUgK/v/vewwec/LhoV64r7SvHbYGnGzE9FiGbY%3D"
        ],
        "requestedBy": "95e4942d-cbe8-477d-aebd-ad8e6de4bfc8",
        "jobStats": {
            "dtJobSubmitted": 1600845394119,
            "dtJobCompleted": 1600845394119,
            "executionTime": 200
        },
        "status": "SUCCESS",
        "dataset": "progress-exhaust",
        "requestId": "AF7B9BE5D0D075EA0DB8C6D12E192D5F",
        "requestedChannel": "ORG_001"
    }
}
```



### Get  LIST API

* Get the list of request details for a particular tag



 **URL : GET : dataset/v1/request/list/{tag}** tag:  unique identifier for the requests submitted. For ex: courseId or batchId. **Request Parameters** 


* request headers


    * X-Channel-ID - channel id / org id for request


    * X-Authenticated-Userid - requested user id



    

Response:


```json
{
    "id": "ekstep.analytics.job.request.list",
    "ver": "1.0",
    "ts": "2016-12-07T12:43:23.890+00:00",
    "params": {
        "resmsgid": "4f04da60-1e24-4d31-aa7b-1daf91c46341",
        "status": "successful"
    },
    "responseCode": "OK",
    "result": {
        "count": Int,
        "jobs": Array[JobStatusResponse]
    }
}
```

## Standard Data Exhaust API details

### Get API

* Get the exhaust data for specific channel



 **URL - GET :** dataset/get/{datasetId}?from=2020-09-10&to=2020-09-14 ordataset/get/{datasetId}?since=2020-09-10

datasetId: data type id. Available options are: summary-channel-exhaust and summary-rollup. **Request Parameters** 


* request headers


    * X-Channel-ID - org slug value


    * X-Authenticated-Userid - requested user id



    

Response:


```json
{
    "id": "org.ekstep.analytics.telemetry",
    "ver": "1.0",
    "ts": "2020-09-14T06:04:13.988+00:00",
    "params": {
        "resmsgid": "d4a5bcb1-bff5-4c7c-a5f2-1c255ba640f0",
        "status": "successful",
        "client_key": null
    },
    "responseCode": "OK",
    "result": {
        "files": [], // list of exhaust files signed url 
        "periodWiseFiles": { // period wise list of exhaust files signed url 
            "<date:yyyy-mm-dd>": []
        },
        "expiresAt": Long // Expiry time for signed url
    }
}
```
Sample Response:

/data/v3/dataset/get/summary-rollup?since=2020-06-16&to=2020-06-17
```
{
    "id": "org.ekstep.analytics.telemetry",
    "ver": "1.0",
    "ts": "2020-09-14T06:04:13.988+00:00",
    "params": {
        "resmsgid": "d4a5bcb1-bff5-4c7c-a5f2-1c255ba640f0",
        "status": "successful",
        "client_key": null
    },
    "responseCode": "OK",
    "result": {
        "files": [
            "https://account-name.blob.core.windows.net/data-store/data-exhaust/summary-rollup/apekx/2020-06-16.csv?sv=2017-04-17&se=2071-05-29T12%3A38%3A26Z&sr=b&sp=r&sig=RIhtghB9znu%2BLTHMPRLYBX%2BrqdSvNleP8lvCwAyO1tA%3D",
            "https://account-name.blob.core.windows.net/data-store/data-exhaust/summary-rollup/apekx/2020-06-17.csv?sv=2017-04-17&se=2071-05-29T12%3A38%3A26Z&sr=b&sp=r&sig=J1U/kt5pnzEmNyuR0A2kaGhPQGt%2BfWkkSQI5C1yjFrk%3D"
        ],
        "periodWiseFiles": {
            "2020-06-17": [
                "https://account-name.blob.core.windows.net/data-store/data-exhaust/summary-rollup/apekx/2020-06-17.csv?sv=2017-04-17&se=2071-05-29T12%3A38%3A26Z&sr=b&sp=r&sig=J1U/kt5pnzEmNyuR0A2kaGhPQGt%2BfWkkSQI5C1yjFrk%3D"
            ],
            "2020-06-16": [
                "https://account-name.blob.core.windows.net/data-store/data-exhaust/summary-rollup/apekx/2020-06-16.csv?sv=2017-04-17&se=2071-05-29T12%3A38%3A26Z&sr=b&sp=r&sig=RIhtghB9znu%2BLTHMPRLYBX%2BrqdSvNleP8lvCwAyO1tA%3D"
            ]
        },
        "expiresAt": 1600065253978
    }
}
```





## Public Data Exhaust API details

### Get API

* Get the CDN links for exhaust data files by specific channel without authentication



 **URL - GET :** public/dataset/get/{datasetId}?from=2020-09-10&to=2020-09-14 orpublic/dataset/get/{datasetId}?since=2020-09-10datasetId: data type id.  **Request Parameters** 


* request headers


    * X-Channel-ID - org slug value



    

Response:


```json
{
    "id": "org.ekstep.analytics.telemetry",
    "ver": "1.0",
    "ts": "2020-09-14T06:04:13.988+00:00",
    "params": {
        "resmsgid": "d4a5bcb1-bff5-4c7c-a5f2-1c255ba640f0",
        "status": "successful",
        "client_key": null
    },
    "responseCode": "OK",
    "result": {
        "files": [], // list of exhaust files CDN url 
        "periodWiseFiles": { // period wise list of exhaust files CDN url 
            "<date:yyyy-mm-dd>": []
        }
    }
}
```
Sample Response:

/data/v3/public/dataset/get/public-summary-rollup?since=2020-06-16&to=2020-06-17
```
{
    "id": "org.ekstep.analytics.telemetry",
    "ver": "1.0",
    "ts": "2020-09-14T06:04:13.988+00:00",
    "params": {
        "resmsgid": "d4a5bcb1-bff5-4c7c-a5f2-1c255ba640f0",
        "status": "successful",
        "client_key": null
    },
    "responseCode": "OK",
    "result": {
        "files": [
            "https://cdn.abc.com/data-store/data-exhaust/public-summary-rollup/apekx/2020-06-16.csv",
            "https://cdn.abc.com/data-store/data-exhaust/public-summary-rollup/apekx/2020-06-17.csv"
        ],
        "periodWiseFiles": {
            "2020-06-17": [
                "https://cdn.abc.com/data-store/data-exhaust/public-summary-rollup/apekx/2020-06-17.csv"
            ],
            "2020-06-16": [
                "https://cdn.abc.com/data-store/data-exhaust/public-summary-rollup/apekx/2020-06-16.csv"
            ]
        }
    }
}
```


*****

[[category.storage-team]] 
[[category.confluence]] 
